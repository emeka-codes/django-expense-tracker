<!DOCTYPE html>
<html>
<head>
    <title>Daily Expenses</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'expense_tracker_app/style.css' %}">
</head>
<body>

    
    <div class="top-header">
        <h1>Expenses Tracker</h1>
        <button><a href="{% url 'user_logout' %}">Logout</a></button>
    </div>
    <div class="add-expense">
        <button onclick="OpenAddExpenseModal()">Add Expenses</button>
    </div>

    

    <form method="post" action="{% url 'delete_expense' %}">
        {% csrf_token %}
        <button type="submit" class="delete-button" name="delete_expense">Delete selected</button>
            <table>
                <tr>
                    <th><input type="checkbox" id="select-all"/></th>
                    <th>Name</th>
                    <th>Product</th>
                    <th>Amount</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Date</th>
                    
                
                </tr>
                {% for expense in today_expenses %}
                <tr>
                    <td><input type="checkbox" name="expense_ids" value="{{ expense.id }}"/></td>
                    <td>{{ expense.name }}</td>
                    <td>{{ expense.product }}</td>
                    <td>{{ expense.amount }}</td>
                    <td>{{ expense.category }}</td>
                    <td>{{ expense.description }}</td>
                    <td>{{ expense.date }}</td>
                    
                    <td><button 
                    
                    type="button"
                    class="edit-btn"
                    data-id="{{ expense.id }}"
                    data-name="{{ expense.name }}"
                    data-product="{{ expense.product }}"
                    data-amount="{{ expense.amount }}"
                    data-category="{{ expense.category }}"
                    data-description="{{ expense.description }}"
                    data-date="{{ expense.date }}"
                    onclick="openEditExpenseModal(this)">Edit</button></td>
                </tr>
                {% endfor %}
            </table>
    </form>
    <h3>Total Spent Today: ₦{{ today_total }}</h3>

    <div id="editModal" class="modal">
        <div class="modal-contents">
            <span class="close">&times;</span>

            <h3>Edit Expense</h3>
            

                <form method="post" action="{% url 'edit_expense_modal' %}">
                    {% csrf_token %}
                    <input type="hidden" name="expense_id" id="expense_id">
                    <div class="form-container">
                    <label>Name</label>
                    <input type="text" name="name" id="name">

                    <label>Product</label>
                    <input type="text" name="product" id="product">

                    <label>Amount</label>
                    <input type="number" name="amount" id="amount">

                    <label>Category</label>
                    <input type="text" name="category" id="category">

                    <label>Description</label>
                    <input type="text" name="description" id="description">

                    <label>Date</label>
                    <input type="date" name="date" id="date">

                    <button type="submit">Update Expense</button>
                    </div>
                    <a href="/app/home">Cancel</a>
                </form>
            
        </div>
    </div>



    <div class="modal" id="expense_modal">
        <div class="modal-contents">
            <div class="header">
                <button><span class="close" onclick="closeAddExpenseModal()">&times;</span></button>
                <h1>Add New Expense</h1>
            </div>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}


    <!--           <div class="form-container">
                    <div class="category">
                        <label>Category:</label>
                        {{ form.category }}<br>
                    </div>
                    <div class="description">
                        <label>Description:</label>
                        {{ form.description }}<br>
                    </div>
                    <div class="amount">
                        <label>Amount:</label>
                        {{ form.amount }}<br>
                    </div>
                    <div class="product_id">
                        <label>Product :</label>
                        {{ form.product }}<br>
                    </div>
                    <div class="partner_id">
                        
                        {{ form.name }}<br>
                    </div>
                    --> 
                    <div class="submit-button">
                        <button type="submit" name="submit_expense">Add</button>
                    </div>
            </form>
        </div>
            
            <br>
            <a href="/">Back to Home</a>
        
    </div>

    {% if filtered_expenses %}
        <h2>Expenses for 
            {% if searched_date %}
                {{ searched_date }}
            {% else %}
                Today
            {% endif %}
        </h2>
        <table>
                <tr>
                    <th>Name</th>
                    <th>Product</th>
                    <th>Amount (₦)</th>
                    <th>Category</th>
                    <th>Description</th>
                    <th>Date</th>
                </tr>
            {% for item in filtered_expenses %}
                <tr>
                    <td>{{ item.name }}</td>
                    <td>{{ item.product }}</td>
                    <td>₦{{ item.amount }}</td>
                    <td>{{ item.category }}</td>
                    <td>{{ item.description }}</td>
                    <td>{{ item.date }}</td>
                </tr>
            {% endfor %}
        </table>
        <p><strong>Total:</strong> ₦{{ total_amount }}</p>
    {% endif %}


    <form method="post" action="{% url 'search_by_date' %}">
        {% csrf_token %}
        
        <input type="date" id="date" name="date" required>
        <button type="submit">Search by Date</button>
    </form>
    
    <script>
        function OpenAddExpenseModal() {
            document.getElementById('expense_modal').style.display= 'flex';
        }
        
        function closeAddExpenseModal() {
            document.getElementById('expense_modal').style.display= 'none';
        }
        // Edit Expense Modal Logic
        function openEditExpenseModal(button) {
            document.getElementById('editModal').style.display='flex';
            

            // Get data attributes from the clicked button
            document.getElementById('expense_id').value = button.dataset.id;
            document.getElementById('name').value = button.dataset.name;
            document.getElementById('product').value = button.dataset.product;
            document.getElementById('amount').value = button.dataset.amount;
            document.getElementById('category').value = button.dataset.category;
            document.getElementById('description').value = button.dataset.description;
            document.getElementById('date').value = button.dataset.date;
        }

        
    // Toggle all checkboxes when #select-all is changed
        document.getElementById('select-all').addEventListener('change', function () {
            const checkboxes = document.querySelectorAll('input[name="expense_ids"]');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });


    </script>


    </body>
    </html>
